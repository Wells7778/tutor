<div class="row">
  <div class="col-9">
    <div class="container-fluid">
      <div class="row row-cols-3 g-2">
        <div class="col-12">
          <div id="search mb-2">
            <input type="text" class="form-control" id="search-input" placeholder="Type" value="{{search}}">
          </div>
        </div>
        {{#each tutors}}
        <a href="/tutors/{{this.id}}" class="text-reset text-decoration-none">
          <div class="col">
            <div class="card mb-3">
              <img src="{{this.User.avatar}}" class="card-img-top" alt="...">
              <div class="card-body">
                <h5 class="card-title">{{this.User.name}}</h5>
                <p class="card-text text-truncate-4">{{this.introduction}}</p>
                <p class="card-text"><small class="text-muted">{{this.User.country}}</small></p>
              </div>
            </div>
          </div>
        </a>
        {{/each}}
        <div class="col-12">
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              <li class="page-item {{#ifNull pagination.prevPage }}disabled{{/ifNull}}">
                <a class="page-link"
                  href="?{{#if pagination.prevPage}}page={{pagination.prevPage}}{{/if}}{{#if search}}&search={{search}}{{/if}}"
                  aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              {{#each pagination.pageNumbers}}
              <li class="page-item {{#ifEqual this ../page }}active{{/ifEqual}}"><a class="page-link"
                  href="?page={{this}}{{#if search}}&search={{search}}{{/if}}">{{this}}</a>
              </li>
              {{/each}}
              <li class="page-item {{#ifNull pagination.nextPage }}disabled{{/ifNull}}">
                <a class="page-link"
                  href="?{{#if pagination.nextPage}}page={{pagination.nextPage}}{{/if}}{{#if search}}&search={{search}}{{/if}}"
                  aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
  <div class="col-3">
    <div class="container-fluid">
      <div class="row row-cols-1 border">
        <div class="col">
          <ul class="nav nav-tabs nav-fill justify-content-center g-2 my-3">
            <li class="nav-item">
              <button class="nav-link active" id="rank-week-tab" data-bs-toggle="tab" data-bs-target="#rank-week"
                type="button" role="tab" aria-controls="rank-week" aria-selected="true">本周排行</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" id="rank-tab" data-bs-toggle="tab" data-bs-target="#rank" type="button"
                role="tab" aria-controls="rank" aria-selected="false">總排行</button>
            </li>
          </ul>
        </div>
        <div class="col tab-content">
          <div class="tab-pane fade show active" id="rank-week" role="tabpanel" aria-labelledby="rank-week-tab"
            tabindex="0">
            {{#each rankStudentsByWeek}}
            <div class="row mb-2">
              <div class="col-4 align-items-center">
                <img src="{{this.avatar}}" class="circle-img-100" alt="...">
              </div>
              <div class="col-8">
                <div class="d-flex align-items-center justify-content-between h-100">
                  <p class="fs-5">No.{{this.rank}} </p>
                  <p class="fw-bold">{{this.name}}</p>
                  <p class="fs-10">
                    <small>
                      {{this.minutes}} min.
                    </small>
                  </p>
                </div>
              </div>
            </div>
            {{/each}}
          </div>
          <div class="tab-pane fade" id="rank" role="tabpanel" aria-labelledby="rank-tab" tabindex="1">
            {{#each rankStudents}}
            <div class="row mb-2">
              <div class="col-4 align-items-center">
                <img src="{{this.avatar}}" class="circle-img-100" alt="...">
              </div>
              <div class="col-8">
                <div class="d-flex align-items-center justify-content-between h-100">
                  <p class="fs-5">No.{{this.rank}} </p>
                  <p class="fw-bold">{{this.name}}</p>
                  <p class="fs-10">
                    <small>
                      {{this.minutes}} min.
                    </small>
                  </p>
                </div>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const searchInput = document.querySelector('#search-input');
  const debounce = (func, delay) => {
    let timer;
    return function () {
      const context = this;
      const args = arguments;
      clearTimeout(timer);
      timer = setTimeout(() => {
        func.apply(context, args);
      }, delay);
    };
  };
  searchInput.addEventListener('input', debounce((e) => {
    const search = e.target.value;
    if (search) {
      window.location.href = `?search=${search}`;
    } else {
      window.location.href = '';
    }
  }, 500));
</script>